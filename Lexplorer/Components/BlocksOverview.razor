@page "/blocks/{page}"
@using Lexplorer.Models
@using Lexplorer.Helpers
@inject Lexplorer.Services.GraphQLService GraphQLService;

@if (blockData != null)
{
    <MudGrid>
        <MudItem xs="12">
            <MudText Typo="Typo.h6">Latest Blocks</MudText>
            <MudTable Items="@blockData.data.blocks" Hover="true">
                <HeaderContent>
                    <MudTh>Block ID</MudTh>
                    <MudTh>L1 Transaction Hash</MudTh>
                    <MudTh>Block Size</MudTh>
                    <MudTh>Time(UTC)</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Block Id">@context.id</MudTd>
                    <MudTd DataLabel="L1 Tx"><a Class="mud-theme-primary" href="https://etherscan.io/tx/@context.txHash" target="_blank">@context.txHash.Substring(0,15)...</a></MudTd>
                    <MudTd DataLabel="Block Size">@context.blockSize</MudTd>
                    <MudTd DataLabel="Timestamp">@TimestampToUTCConverter.Convert(@context.timestamp)</MudTd>
                </RowTemplate>
            </MudTable>
        </MudItem>
    </MudGrid>
}
else
{
    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
}

@code {
    private Blocks blockData;

    [Parameter]
    public string page { get; set; }

    /*
    protected override async Task OnInitializedAsync()
    {
        blockData = await GraphQLService.GetBlocks(Int32.Parse(page) * 25 ,25)
    }
    */

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            blockData = await GraphQLService.GetBlocks(Int32.Parse(page) * 25, 25);
            StateHasChanged();
        }
    }
}
